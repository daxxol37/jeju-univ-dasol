// 글로벌 변수로 덱 ID를 저장
let deckId;

// 카드별 운세 매핑 객체
const cardFortunes = {
    "ACE of HEARTS": "업무나 학업으로 인해 시간 가는 줄 모르겠군요. 정신 없이 하루가 흘러갈 수 있으니 건강을 조심하세요. 또한 친구와의 대화 속에 오해가 생길 수 있으니 말을 아껴야 돼요.",
    "2 of HEARTS": "모처럼 찾아온 기회를 놓치면 안 돼요! 갑작스러워 주저할 수 있겠지만 기회를 놓치는 불행을 겪지 않기를 바라요. 늘 하던 대로 소신 있게 행동한다면 문제없으니 걱정하지 마세요.",
    "3 of HEARTS": "그동안 계획했던 일에 문제가 생길 수 있어요. 하지만 포기하기는 아직 일러요. 동족에서 귀인을 만나 문제를 해결해줄 것이니 조급해하지 말고 마음을 편안하게 해주는 것이 중요해요.",
    "4 of HEARTS":"밖으로 나가면 즐거움과 이익이 따르니, 적극적으로 활동을 펼쳐 보세요. 학교에서는 친구들 사이에서 인기가 높아지고, 새로운 이성과도 인연이 닿을 수 있어요.",
    "5 of HEARTS":"신중하지 않고 급히 서두르면 큰 손해가 생길 거예요. 지혜로운 조언자를 빨리 구해 보세요. 혼자 해결하는 것 보다는 누군가의 도움이 절실히 필요한 순간이예요. 현명하게 움직이세요.",
    "6 of HEARTS":"믿을 사람 하나 없다더니 어제의 동지가 오늘의 적이 되어 나의 뒤에 서있는 상황이에요. 황당함과 막막함으로 더욱 궁지에 빠져들 수 있으니 정신을 바짝 차려야 해요.",
    "7 of HEARTS":"가벼운 외출이나 여행을 떠나기에 아주 좋은 운 이에요. 가까운 친척이나 자식들 집에 찾아간다면 즐거운 하루를 보낼 수 있어요. 무거운 짐은 도움이 안 되니 가볍게 방문하세요.",
    "8 of HEARTS":"우와~ 원하는 대로 일이 진행되니 걱정할게 하나도 없어요. 이런 날은 가벼운 마음으로 외출하는 것이 좋아요. 사랑하는 가족, 친구, 연인과 함께 즐거운 시간을 만들어보세요.",
    "9 of HEARTS":"잘못된 만남! 힘든 하루가 될 수 있겠군요. 친구든 애인이든 만나면 불화와 다툼의 연속이니, 잠시 휴식 기간을 서로 가져보는 것도 좋겠네요. 혼자 감당하기 어렵겠군요.",
    "10 of HEARTS":"다른 사람과 일 을 도모하지 마세요. 여러 사람이 모여 일을 계획 한다 하더라도 결국은 시간 낭비 일 뿐 이예요. 혼자 무엇이든 결정하고 단독으로 움직여야 성과가 클 거예요.",
    "JACK of HEARTS": "시간만 낭비할 수 있겠네요. 신중하게 처신해도 본전이면 다행이군요. 업무적인 스트레스를 친구들과의 술자리에서 풀어보세요. 뜻밖의 귀한 정보를 구할 수 있어요.",
    "KING of HEARTS":"손님에게 감기를 옮거나 좋지 못한 소식을 들을 수 있어요. 오늘 누군가를 만나기보다는 혼자만의 시간을 가지는 것이 좋겠네요. 아쉽지만 초대하거나 방문하는 것은 다음으로 미루세요.",
    "QUEEN of HEARTS":"편안한 하루를 보내기에 부족함이 없는 날이에요. 사랑하는 가족, 친구, 연인과 함께 즐거운 시간을 만들어보세요. 좋은 추억이 되겠네요.",
    "ACE of SPADES": "오늘 당신의 운이 순조로우니, 부드러운 바람에 돛을 단 듯 순탄한 하루를 보낼 수 있을 거예요. 지금까지 생각만 해왔던 일들을 이루는데 전혀 문제없는 하루가 될 것 같네요.",
    "2 of SPADES": "와우~ 애정 운이 좋게 반영되는 하루 이군요. 망설이지 말고 좋아하는 상대에게 조금씩 접근해 보세요. 무언가 시도를 해야 되요. 생각지도 못한 해피한 하루를 보낼 수 있어요.",
    "3 of SPADES": "와우~ 나의 매력과 진가를 발휘 하겠군요. 솔직하게 마음을 털어 놓으면 상대방의 마음을 사로잡을 수 있어요. 사랑의 행운이 당신 곁에 있으니 적극적으로 움직이세요.",
    "4 of SPADES": "오늘은 무엇보다 재물운이 좋아요. 금융 관련된 상품으로부터 좋은 소식이 기대되네요. 이른 아침부터 좋은 소식이 있을 예정이니 평소보다 기분 좋게 아침을 시작하세요!",
    "5 of SPADES": "상황을 정리하면서 주변을 살펴보는 시간을 가지세요. 무슨 일이든지 최선을 다하는 자세로 사는 것도 참 멋있는 삶이지만, 오늘은 평범하게 여유 있는 시간을 만들어 보세요.",
    "6 of SPADES": "생각지도 못했던 수입이 생기네요. 학업 또한 자신의 생각대로 성적이 오르거나 인정을 받는 기쁨이 따르는군요. 오늘은 짝 사랑하는 사람에게도 고백하기 좋은 최상의 날 이예요.",
    "7 of SPADES": "기다리던 일 에서 반가운 소식이 들리겠네요. 그 동안 미루었던 일을 진행해도 무리가 없군요. 예리한 판단력과 넘치는 에너지를 효율적으로 활용하는 시간을 만들어 보세요.",
    "8 of SPADES": "사고 파는 일에서 유리함이 작용하고 있으니, 분주하게 움직여야 해요. 나의 지혜로움과 순발력으로 이익을 도모하기에 최상의 날 이군요. 중요한 사안이 있다면 스스로 결정하세요.",
    "9 of SPADES": "갈등은 대화로 풀어야 해요. 서로를 이해한다면 더 이상의 아픔과 고통은 없을 거예요. 상대방의 사과를 기다리기보다는 먼저 화해를 청하는 것이 순서임을 기억하세요.",
    "10 of SPADES": "잎만 무성한 가지에 소리만 요란할 뿐! 별 다른 소득 없이 피곤한 하루를 보낼 수 있어요. 이럴 때일수록 조급해하지 말고 편안한 마음으로 상황을 지켜보는 것도 나쁘지 않아요.",
    "JACK of SPADES": "오늘 같은 날은 집중력이 저하되고, 수업 시간이 무척 지루하게 느껴 지겠군요. 긍정적으로 생각하고 마인드 컨트롤에 집중하세요. 오늘 일을 절대 내일로 미루지 마세요.",
    "KING of SPADES": "천생연분을 만나는 운명적인 날 이군요. 미팅이나 소개팅이 있다면 절대 미루지 마세요. 새로운 인연으로 인해서 가슴이 뛰고, 나의 이상형을 비로소 찾게 될 거예요.",
    "QUEEN of SPADES": "만남이 모든 것을 해결해 주지는 않아요. 오늘은 만나면 싸울 확률이 높고 신경전으로 인해 서로가 더욱 피곤해지니 오늘을 피하고 다른 날로 약속을 잡아보세요.",
    "ACE of DIAMONDS": "어머나, 서쪽에서 귀인이 나타나 금전적으로 도움을 줄 거예요. 오전에 견디기 힘든 일이 일어나더라도 걱정하지 마세요. 시간이 지나면 모든 일이 거짓말처럼 해결되어 있을 거예요.",
    "2 of DIAMONDS": "이런.. 진행하는 일마다 실수를 반복하게 되네요. 이런 상황에서 앞으로 더 나아가려 한다면 독이 될 수 있으니 한 발자국 물러나서 마음을 비우고 또 다른 기회를 기다리세요.",
    "3 of DIAMONDS": "원하는 것을 얻지 못한 상황이므로 마음이 불안정한 상태이군요. 오늘 만큼은 친구나 가족 등 주변의 조언을 귀담아 들으세요. 의외의 성과를 얻을 수 있어요.",
    "4 of DIAMONDS": "가족의 건강과 마음을 돌보는데 집중 하세요. 가족과 즐거움을 함께 나누고, 어려움을 의논하세요. 가까운 사람으로부터 나 또한 격려와 위안을 받게 될 거예요.",
    "5 of DIAMONDS": "하락세를 타고 있는 격이군요. 신중하게 움직여도 결과는 기대 이하이니 빨리 포기하세요. 새로운 일의 시작이나 새로운 사람들과의 만남에 이익이 깃들어 있네요.",
    "6 of DIAMONDS": "복잡한 마음을 정리하고 긴장을 풀어야 해요. 주변 사람들과 부드러운 관계를 유지하는 것이 가장 좋아요. 다툼으로 인한 이별이 생길 수 있으니 신중하게 얘기하세요.",
    "7 of DIAMONDS": "와~ 금전운이 정말 좋은 날이에요. 걱정하고 있던 일은 잘 해결되겠네요. 재운이 당신 곁에 머물고 있으니 은행을 방문한다면 좋은 기회를 잡을 수 있어요. 계획적으로 움직이세요.",
    "8 of DIAMONDS": "오늘은 나 자신을 반성해 보는 시간을 가지세요. 아무리 노력한다 하더라도 결국 이길 수 없는 게임을 하고 있군요. 게임이나 이성간의 만남은 잠시 자제하고 자신의 일에 충실해야 되요.",
    "9 of DIAMONDS": "생각지도 않았던 지출로 인해 경제적인 곤란함을 겪게 되겠군요. 돈을 효율적으로 움직이기 위해 부단한 노력을 아끼지 말아야 해요. 주변의 조언을 듣는 것도 필요해요.",
    "10 of DIAMONDS": "당신에게는 모든 것이 불리한 상황이군요. 그 동안 노력해 왔던 일들이 한 순간에, 무너져 버릴 수 있으니 조심하세요. 주변에 조언을 구할 수 있는 사람을 빨리 찾아 나서세요.",
    "JACK of DIAMONDS": "다행히도 걱정하던 것과 달리 오늘은 아픈 곳 없이 건강하게 보낼 수 있어요. 돈도 친구도 중요하지만 무엇보다도 건강이 우선이라는 것을 언제나 잊지 마세요.",
    "KING of DIAMONDS": "혹시 이별을 고민하고 있나요? 사랑하는 사람의 마음을 아프게 하면서 좋지 않은 결정을 내린다면 앞으로 더 힘들어질 수 있어요. 서로를 더 힘들게 할 수 있다는 걸 명심하세요.",
    "QUEEN of DIAMONDS": "학교 생활에서 기쁜 일이 생기네요. 변화를 두려워하지 말고 용기를 내어, 하고 싶은 일에 도전해 보세요. 소망하는 일이 이루어지고 능력을 인정받게 되는 기분 좋은 날 이거든요.",
    "ACE of CLUBS": "연인과 이별의 징조가 보이니, 인연이 아니라고 판단 된다면 빨리 이별을 고하세요. 시간이 지날수록 상처만 깊어 져요. 이성 문제로 사회 활동까지 방해 받지 않도록 조심하세요.",
    "2 of CLUBS": "급하게 서두르지 마세요. 목표를 달성할 수 있으니 조급함을 버리세요. 나로 인해 주변 사람들이 행복해지고 나의 능력을 인정받게 되는 순간이군요. 모든 상황이 원만하게 전개되네요.",
    "3 of CLUBS": "걱정은 뒤로 미루세요. 주저하지 말고 진행해야 좋은 결과를 얻을 수 있어요. 긴장은 금물! 아무런 방해 없이 마음을 달랠 수 있는 멋있는 일들을 경험하게 될 거예요.",
    "4 of CLUBS": "몸과 마음이 가벼워지는 기분 좋은 하루 이군요. 집중력도 좋아지므로 공부에 전념하기 좋군요. 이성 운도 좋아서 가까운 이성 친구에게 생각지도 못한 고백을 들을 수도 있어요.",
    "5 of CLUBS": "과거에 연연하지 말고 현재에 충실하세요. 시간을 쪼개어 활용하고 바삐 움직이면, 내가 원하는 것을 얻을 수 있을 거예요. 일을 미루지 말고 오늘 안에 해결 하세요.",
    "6 of CLUBS": "힘들고 어려웠던 일 들이 해결의 실마리가 보이는군요. 멀리서 찾아오는 손님 또한 나를 지지해 주고, 계약이나 매매 등으로 이익도 생기겠군요. 원하는 것을 얻게 될 거예요.",
    "7 of CLUBS": "빨리 손을 쓰지 않으면 곤란한 상황에서 벗어나기 힘들 수 있겠군요. 알 수 없는 기대감에 더 큰 피해를 보면서 손해를 배상해야 하는 어려움이 있을 수 있어요.",
    "8 of CLUBS": "그동안 괴롭혔던 병이 있다면 오늘 좋아질 조짐이 보여요. 외적인 치료도 중요하지만 마음의 안정도 중요하다는 것을 잊지 마세요. 오랜만에 가벼운 여행을 계획해보는 것도 좋겠어요.",
    "9 of CLUBS": "오늘은 도보 또는 대중교통을 이용하는 것이 좋겠네요. 차량 이동 중 사고가 있을 수 있으니 이에 대비하세요. 어느 때보다 차량 정비에 신경 써야 할 거예요. 조심 또 조심하세요.",
    "10 of CLUBS": "기대했던 만큼 성적이 오르거나, 사랑이 이루어지는 등 행운의 날 이군요. 주저하지 말고 무엇이든 자신감있게 실행에 옮겨 보세요. 중요한 사안을 결정하기 최적의 하루 예요.",
    "JACK of CLUBS": "가장 왕성한 활동을 시작하세요. 주저하지 마시고 추진력 있게 진행하면, 주변에서 나를 지지하는 사람도 생겨날 거예요. 또한 시간을 쪼개어 서라도 가족과의 시간을 가져보세요.",
    "KING of CLUBS": "와우~ 여행이나 외출하기 정말 좋은 날이에요. 여행길이 술술 풀리니 소중한 사람들이나 직장 동료들과 단합 대회를 떠난다면 모두가 즐거운 시간이 될 거예요.",
    "QUEEN of CLUBS": "진행하고 있는 일이 있다면 인정을 받을 기회가 올 거예요. 주저하지 말고 적극적으로 행동해서 기회를 놓치지 말아야 해요. 하지만 순리를 따르지 않으면 승산이 없으니 조심하세요.",
};

// 새로운 덱을 생성하고 섞은 후, 덱 ID를 저장
function initializeDeck() {
    fetch('https://deckofcardsapi.com/api/deck/new/shuffle/')
        .then(response => response.json())
        .then(data => {
            deckId = data.deck_id;
            drawCards(); // 덱이 준비되면 카드를 뽑습니다.
        })
        .catch(error => {
            console.error('Deck Initialization Error:', error);
        });
}

// 여러 장의 카드를 뽑고 화면에 표시하는 함수
function drawCards() {
    fetch(`https://deckofcardsapi.com/api/deck/${deckId}/draw/?count=25`) // 카드 개수 설정
        .then(response => response.json())
        .then(data => {
            const cards = data.cards;
            const cardsContainer = document.getElementById('cards');
            cardsContainer.innerHTML = ''; // 기존 카드 삭제

            if (cards.length === 0) {
                console.log('No cards available');
                return;
            }

            // 카드가 겹치게 표시되도록 설정
            cards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.classList.add('card');
                cardElement.dataset.card = JSON.stringify(card); // 카드 데이터를 저장

                // 카드 위치 설정 (left, top 적용)
                cardElement.style.left = `${index * 30}px`; // X축 좌표
                cardElement.style.zIndex = `${index}`;      // 카드 순서

                // z-index와 left, top 값 디버깅
                console.log(`Card ${index}: left=${cardElement.style.left}, z-index=${cardElement.style.zIndex}`);

                // 카드 클릭 시 선택된 카드 보여주기
                cardElement.onclick = () => displayCard(cardElement);
                cardsContainer.appendChild(cardElement);
            });
        })
        .catch(error => {
            console.error('Card Draw Error:', error);
        });
}


// 카드의 운세를 가져오는 함수
function getFortune(value, suit) {
    const key = `${value} of ${suit}`;
    return cardFortunes[key] || "오늘은 평범하지만 좋은 일이 있을 것입니다.";
}

// 선택된 카드의 정보와 운세를 보여주는 함수
function displayCard(cardElement) {
    const card = JSON.parse(cardElement.dataset.card); // 클릭된 카드의 데이터 가져오기
    const selectedCardDiv = document.getElementById('selected-card');

    // 카드 앞면을 보여줌
    cardElement.style.backgroundImage = `url(${card.image})`; // 앞면 이미지로 변경

    // 선택된 카드의 이미지와 운세 텍스트 업데이트
    selectedCardDiv.innerHTML = `<img src="${card.image}" alt="${card.value} of ${card.suit}" width="160px">`;

    // 운세 표시
    document.getElementById('fortune').innerHTML = getFortune(card.value, card.suit);
}

// 페이지 로드 시 덱을 초기화
initializeDeck();